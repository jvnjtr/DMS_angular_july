import { Injectable } from '@angular/core';
import * as CryptoJS from 'crypto-js';
import { Buffer } from 'buffer';
import Swal from 'sweetalert2';
import * as i0 from "@angular/core";
import * as i1 from "@angular/router";
import * as i2 from "@angular/common/http";
import * as i3 from "./varlist.service";
export class MsgengineLibService {
    constructor(router, http, varlist) {
        this.router = router;
        this.http = http;
        this.varlist = varlist;
    }
    directlogoutlib() {
        sessionStorage.removeItem('ADMIN_SESSION');
        sessionStorage.removeItem('TOKEN');
        this.router.navigateByUrl('/login');
    }
    getGetwayName(formParams) {
        let requestParam = Buffer.from(JSON.stringify(formParams), 'utf8').toString('base64');
        let requestToken = CryptoJS.HmacSHA256(requestParam, this.varlist.apiHashingKey).toString();
        let reqData = { 'REQUEST_DATA': requestParam, 'REQUEST_TOKEN': requestToken };
        let serviceURL = this.varlist.serviceURL + '/getwayConfiguration';
        let desnResponse = this.http.post(serviceURL, reqData);
        return desnResponse;
    }
    viewGatwayTypes(formParams) {
        let requestParam = Buffer.from(JSON.stringify(formParams), 'utf8').toString('base64');
        let requestToken = CryptoJS.HmacSHA256(requestParam, this.varlist.apiHashingKey).toString();
        let reqData = { 'REQUEST_DATA': requestParam, 'REQUEST_TOKEN': requestToken };
        let serviceURL = this.varlist.serviceURL + '/getwayType';
        let desnResponse = this.http.post(serviceURL, reqData);
        return desnResponse;
    }
    newGetwayConfig(docParams) {
        let requestParam = btoa(JSON.stringify(docParams));
        let requestToken = CryptoJS.HmacSHA256(requestParam, this.varlist.apiHashingKey).toString();
        let reqData = { 'REQUEST_DATA': requestParam, 'REQUEST_TOKEN': requestToken };
        let serviceUrl = this.varlist.serviceURL + '/insertGatewayConfiguration';
        let serviceRes = this.http.post(serviceUrl, reqData);
        return serviceRes;
    }
    viewGetwayConfig(docParams) {
        let requestParam = btoa(JSON.stringify(docParams));
        let requestToken = CryptoJS.HmacSHA256(requestParam, this.varlist.apiHashingKey).toString();
        let reqData = { 'REQUEST_DATA': requestParam, 'REQUEST_TOKEN': requestToken };
        let serviceUrl = this.varlist.serviceURL + '/viewConfiguration';
        let serviceRes = this.http.post(serviceUrl, reqData);
        return serviceRes;
    }
    getPrevDetails(docParams) {
        let requestParam = btoa(JSON.stringify(docParams));
        let requestToken = CryptoJS.HmacSHA256(requestParam, this.varlist.apiHashingKey).toString();
        let reqData = { 'REQUEST_DATA': requestParam, 'REQUEST_TOKEN': requestToken };
        let serviceUrl = this.varlist.serviceURL + '/fillAll';
        let serviceRes = this.http.post(serviceUrl, reqData);
        return serviceRes;
    }
    deleteGetwayConfig(docParams) {
        let requestParam = btoa(JSON.stringify(docParams));
        let requestToken = CryptoJS.HmacSHA256(requestParam, this.varlist.apiHashingKey).toString();
        let reqData = { 'REQUEST_DATA': requestParam, 'REQUEST_TOKEN': requestToken };
        let serviceUrl = this.varlist.serviceURL + '/deletegetwayDocument';
        let serviceRes = this.http.post(serviceUrl, reqData);
        return serviceRes;
    }
    deleteAll(formParams, fname) {
        let requestParam = btoa(JSON.stringify(formParams));
        let requestToken = CryptoJS.HmacSHA256(requestParam, this.varlist.apiHashingKey).toString();
        let reqData = {
            REQUEST_DATA: requestParam,
            REQUEST_TOKEN: requestToken
        };
        let serviceUrl = this.varlist.serviceURL + fname;
        let serviceRes = this.http.post(serviceUrl, reqData);
        return serviceRes;
    }
    publishAll(formParams, fname) {
        let requestParam = btoa(JSON.stringify(formParams));
        let requestToken = CryptoJS.HmacSHA256(requestParam, this.varlist.apiHashingKey).toString();
        let reqData = {
            REQUEST_DATA: requestParam,
            REQUEST_TOKEN: requestToken
        };
        let serviceUrl = this.varlist.serviceURL + fname;
        let serviceRes = this.http.post(serviceUrl, reqData);
        return serviceRes;
    }
    unpublishAll(formParams, fname) {
        let requestParam = btoa(JSON.stringify(formParams));
        let requestToken = CryptoJS.HmacSHA256(requestParam, this.varlist.apiHashingKey).toString();
        let reqData = {
            REQUEST_DATA: requestParam,
            REQUEST_TOKEN: requestToken
        };
        let serviceUrl = this.varlist.serviceURL + fname;
        let serviceRes = this.http.post(serviceUrl, reqData);
        return serviceRes;
    }
    newMessage(messageParams) {
        let requestParam = btoa(JSON.stringify(messageParams));
        let requestToken = CryptoJS.HmacSHA256(requestParam, this.varlist.apiHashingKey).toString();
        let reqData = { 'REQUEST_DATA': requestParam, 'REQUEST_TOKEN': requestToken };
        let serviceUrl = this.varlist.serviceURL + '/addMessageConfig';
        let serviceRes = this.http.post(serviceUrl, reqData);
        return serviceRes;
    }
    // newMessage(messageParams: any): Observable<any> {
    //   let serviceUrl = this.varlist.serviceURL + 'addMessageConfig';
    //   let serviceRes = this.http.post(serviceUrl, messageParams);
    //   return serviceRes;
    // }
    viewMessage(messageParams) {
        let requestParam = btoa(JSON.stringify(messageParams));
        let requestToken = CryptoJS.HmacSHA256(requestParam, this.varlist.apiHashingKey).toString();
        messageParams = { 'REQUEST_DATA': requestParam, 'REQUEST_TOKEN': requestToken };
        let serviceUrl = this.varlist.serviceURL + '/viewMessageConfig';
        let serviceRes = this.http.post(serviceUrl, messageParams);
        return serviceRes;
    }
    reminderSchedular(messageParams) {
        let requestParam = btoa(JSON.stringify(messageParams));
        let requestToken = CryptoJS.HmacSHA256(requestParam, this.varlist.apiHashingKey).toString();
        messageParams = { 'REQUEST_DATA': requestParam, 'REQUEST_TOKEN': requestToken };
        let serviceUrl = this.varlist.serviceURL + '/getRemindercron';
        let serviceRes = this.http.post(serviceUrl, messageParams);
        return serviceRes;
    }
    msgexecuteSchedular(messageParams) {
        let requestParam = btoa(JSON.stringify(messageParams));
        let requestToken = CryptoJS.HmacSHA256(requestParam, this.varlist.apiHashingKey).toString();
        messageParams = { 'REQUEST_DATA': requestParam, 'REQUEST_TOKEN': requestToken };
        let serviceUrl = this.varlist.serviceURL + '/startExecution';
        let serviceRes = this.http.post(serviceUrl, messageParams);
        return serviceRes;
    }
    msgstopSchedular(messageParams) {
        let requestParam = btoa(JSON.stringify(messageParams));
        let requestToken = CryptoJS.HmacSHA256(requestParam, this.varlist.apiHashingKey).toString();
        messageParams = { 'REQUEST_DATA': requestParam, 'REQUEST_TOKEN': requestToken };
        let serviceUrl = this.varlist.serviceURL + '/stopExecution';
        let serviceRes = this.http.post(serviceUrl, messageParams);
        return serviceRes;
    }
    getStaticConfigurationKeys(messageParams) {
        let requestParam = btoa(JSON.stringify(messageParams));
        let requestToken = CryptoJS.HmacSHA256(requestParam, this.varlist.apiHashingKey).toString();
        messageParams = { 'REQUEST_DATA': requestParam, 'REQUEST_TOKEN': requestToken };
        let serviceUrl = this.varlist.serviceURL + '/GetStaticKeys';
        let serviceRes = this.http.post(serviceUrl, messageParams);
        return serviceRes;
    }
    getFetchPublishRecord(messageParams) {
        let requestParam = btoa(JSON.stringify(messageParams));
        let requestToken = CryptoJS.HmacSHA256(requestParam, this.varlist.apiHashingKey).toString();
        messageParams = { 'REQUEST_DATA': requestParam, 'REQUEST_TOKEN': requestToken };
        let serviceUrl = this.varlist.serviceURL + '/FetchPublishRecord';
        let serviceRes = this.http.post(serviceUrl, messageParams);
        return serviceRes;
    }
    getLanguage(messageParams) {
        let requestParam = btoa(JSON.stringify(messageParams));
        let requestToken = CryptoJS.HmacSHA256(requestParam, this.varlist.apiHashingKey).toString();
        messageParams = { 'REQUEST_DATA': requestParam, 'REQUEST_TOKEN': requestToken };
        let serviceUrl = this.varlist.serviceURL + '/viewLanguage';
        let serviceRes = this.http.post(serviceUrl, messageParams);
        return serviceRes;
    }
    getForms(messageParams) {
        let requestParam = btoa(JSON.stringify(messageParams));
        let requestToken = CryptoJS.HmacSHA256(requestParam, this.varlist.apiHashingKey).toString();
        messageParams = { 'REQUEST_DATA': requestParam, 'REQUEST_TOKEN': requestToken };
        let serviceUrl = this.varlist.serviceURL + '/getFormName';
        let serviceRes = this.http.post(serviceUrl, messageParams);
        return serviceRes;
    }
    getConfigurationKeys(messageParams) {
        let requestParam = btoa(JSON.stringify(messageParams));
        let requestToken = CryptoJS.HmacSHA256(requestParam, this.varlist.apiHashingKey).toString();
        messageParams = { 'REQUEST_DATA': requestParam, 'REQUEST_TOKEN': requestToken };
        let serviceUrl = this.varlist.serviceURL + '/getConfigKeys';
        let serviceRes = this.http.post(serviceUrl, messageParams);
        return serviceRes;
    }
    msguploadFile(formParams) {
        let serviceURL = this.varlist.serviceURL + '/fileUpload';
        let moduleResponse = this.http.post(serviceURL, formParams);
        return moduleResponse;
    }
    langReplace(languageText, languageName = "") {
        if (languageText != "" && languageText != undefined) {
            let lngToLower = languageText.toLowerCase();
            let allLangListResult = sessionStorage.getItem("ALL_LANG_LIST");
            let SeetionParsedLangRes = JSON.parse(CryptoJS.AES.decrypt(allLangListResult, this.varlist.apiHashingKey).toString(CryptoJS.enc.Utf8));
            let sessionUserLangtoken = sessionStorage.getItem("USER_LANGPREF");
            let sessionUserLang = JSON.parse(CryptoJS.AES.decrypt(sessionUserLangtoken, this.varlist.apiHashingKey).toString(CryptoJS.enc.Utf8));
            if (SeetionParsedLangRes[lngToLower] != undefined) {
                let allParsedLang = JSON.parse(SeetionParsedLangRes[lngToLower]);
                return allParsedLang[sessionUserLang] != "" && allParsedLang[sessionUserLang] != undefined
                    ? allParsedLang[sessionUserLang]
                    : languageText;
            }
            else {
                return languageText;
            }
        }
        else {
            return languageText;
        }
    }
    swalfire(type, message) {
        return Swal.fire({
            icon: type,
            text: message
        });
    }
}
MsgengineLibService.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "14.2.12", ngImport: i0, type: MsgengineLibService, deps: [{ token: i1.Router }, { token: i2.HttpClient }, { token: i3.VarlistService }], target: i0.ɵɵFactoryTarget.Injectable });
MsgengineLibService.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "14.2.12", ngImport: i0, type: MsgengineLibService, providedIn: 'root' });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "14.2.12", ngImport: i0, type: MsgengineLibService, decorators: [{
            type: Injectable,
            args: [{
                    providedIn: 'root'
                }]
        }], ctorParameters: function () { return [{ type: i1.Router }, { type: i2.HttpClient }, { type: i3.VarlistService }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibXNnZW5naW5lLWxpYi5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vcHJvamVjdHMvbXNnZW5naW5lLWxpYi9zcmMvbGliL21zZ2VuZ2luZS1saWIuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBSzNDLE9BQU8sS0FBSyxRQUFRLE1BQU0sV0FBVyxDQUFDO0FBRXRDLE9BQU8sRUFBQyxNQUFNLEVBQUMsTUFBTSxRQUFRLENBQUM7QUFFOUIsT0FBTyxJQUFJLE1BQU0sYUFBYSxDQUFDOzs7OztBQVEvQixNQUFNLE9BQU8sbUJBQW1CO0lBSzlCLFlBQ1UsTUFBYyxFQUNkLElBQWdCLEVBQ2YsT0FBc0I7UUFGdkIsV0FBTSxHQUFOLE1BQU0sQ0FBUTtRQUNkLFNBQUksR0FBSixJQUFJLENBQVk7UUFDZixZQUFPLEdBQVAsT0FBTyxDQUFlO0lBQzFCLENBQUM7SUFHRSxlQUFlO1FBQ3JCLGNBQWMsQ0FBQyxVQUFVLENBQUMsZUFBZSxDQUFDLENBQUM7UUFDM0MsY0FBYyxDQUFDLFVBQVUsQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUNuQyxJQUFJLENBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsQ0FBQztJQUN4QyxDQUFDO0lBRU0sYUFBYSxDQUFDLFVBQWM7UUFFakMsSUFBSSxZQUFZLEdBQUUsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLFVBQVUsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUNyRixJQUFJLFlBQVksR0FBRyxRQUFRLENBQUMsVUFBVSxDQUFDLFlBQVksRUFBRSxJQUFJLENBQUMsT0FBTyxDQUFDLGFBQWEsQ0FBQyxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBQzVGLElBQUksT0FBTyxHQUFHLEVBQUUsY0FBYyxFQUFFLFlBQVks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QyxVQUFVLENBQUMsQ0FBQyxDQUFDO2dCQUNqRSxPQUFPLGFBQWEsQ0FBQyxlQUFlLENBQUMsSUFBSSxFQUFFLElBQUksYUFBYSxDQUFDLGVBQWUsQ0FBQyxJQUFJLFNBQVM7b0JBQ3hGLENBQUMsQ0FBQyxhQUFhLENBQUMsZUFBZSxDQUFDO29CQUNoQyxDQUFDLENBQUMsWUFBWSxDQUFDO2FBQ2pCO2lCQUFNO2dCQUNMLE9BQU8sWUFBWSxDQUFDO2FBQ3RCO1NBQ0Q7YUFBTTtZQUNMLE9BQU8sWUFBWSxDQUFDO1NBQ3JCO0lBQ0osQ0FBQztJQUdELFFBQVEsQ0FBQyxJQUFTLEVBQUUsT0FBWTtRQUMvQixPQUFRLElBQUksQ0FBQyxJQUFJLENBQUM7WUFDVCxJQUFJLEVBQUUsSUFBSTtZQUNWLElBQUksRUFBRSxPQUFPO1NBQ1osQ0FBQyxDQUFDO0lBRWIsQ0FBQzs7aUhBMVBXLG1CQUFtQjtxSEFBbkIsbUJBQW1CLGNBRmxCLE1BQU07NEZBRVAsbUJBQW1CO2tCQUgvQixVQUFVO21CQUFDO29CQUNWLFVBQVUsRUFBRSxNQUFNO2lCQUNuQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFJvdXRlciB9IGZyb20gJ0Bhbmd1bGFyL3JvdXRlcic7XG5pbXBvcnQgeyBIdHRwQ2xpZW50IH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xuaW1wb3J0IHsgQmVoYXZpb3JTdWJqZWN0LCBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBtYXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgKiBhcyBDcnlwdG9KUyBmcm9tICdjcnlwdG8tanMnO1xuXG5pbXBvcnQge0J1ZmZlcn0gZnJvbSAnYnVmZmVyJztcbmltcG9ydCB7IFZhcmxpc3RTZXJ2aWNlIH0gZnJvbSAnLi92YXJsaXN0LnNlcnZpY2UnO1xuaW1wb3J0IFN3YWwgZnJvbSAnc3dlZXRhbGVydDInO1xuXG5cblxuXG5ASW5qZWN0YWJsZSh7XG4gIHByb3ZpZGVkSW46ICdyb290J1xufSlcbmV4cG9ydCBjbGFzcyBNc2dlbmdpbmVMaWJTZXJ2aWNlIHtcblxuXG5cblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIHJvdXRlcjogUm91dGVyLCBcbiAgICBwcml2YXRlIGh0dHA6IEh0dHBDbGllbnQsXG4gICAgIHByaXZhdGUgdmFybGlzdDpWYXJsaXN0U2VydmljZVxuICAgICApIHsgfVxuXG5cbiAgICAgcHVibGljIGRpcmVjdGxvZ291dGxpYigpe1xuICAgICAgc2Vzc2lvblN0b3JhZ2UucmVtb3ZlSXRlbSgnQURNSU5fU0VTU0lPTicpO1xuICAgICAgc2Vzc2lvblN0b3JhZ2UucmVtb3ZlSXRlbSgnVE9LRU4nKTtcbiAgICAgIHRoaXMucm91dGVyLm5hdmlnYXRlQnlVcmwoJy9sb2dpbicpO1xuICB9XG5cbiAgcHVibGljIGdldEdldHdheU5hbWUoZm9ybVBhcmFtczphbnkpOk9ic2VydmFibGU8YW55PiB7XG5cbiAgICBsZXQgcmVxdWVzdFBhcmFtID1CdWZmZXIuZnJvbShKU09OLnN0cmluZ2lmeShmb3JtUGFyYW1zKSwgJ3V0ZjgnKS50b1N0cmluZygnYmFzZTY0Jyk7XG4gICAgbGV0IHJlcXVlc3RUb2tlbiA9IENyeXB0b0pTLkhtYWNTSEEyNTYocmVxdWVzdFBhcmFtLCB0aGlzLnZhcmxpc3QuYXBpSGFzaGluZ0tleSkudG9TdHJpbmcoKTtcbiAgICBsZXQgcmVxRGF0YSA9IHsgJ1JFUVVFU1RfREFUQSc6IHJlcXVlc3RQYXJhbSwgJ1JFUVVFU1RfVE9LRU4nOiByZXF1ZXN0VG9rZW4gfTtcbiAgICBsZXQgc2VydmljZVVSTCA9IHRoaXMudmFybGlzdC5zZXJ2aWNlVVJMICsgJy9nZXR3YXlDb25maWd1cmF0aW9uJztcbiAgICBsZXQgZGVzblJlc3BvbnNlID0gdGhpcy5odHRwLnBvc3Qoc2VydmljZVVSTCwgcmVxRGF0YSk7XG4gICAgcmV0dXJuIGRlc25SZXNwb25zZTtcbiBcbiAgfVxuXG5cblxuICBwdWJsaWMgdmlld0dhdHdheVR5cGVzKGZvcm1QYXJhbXM6YW55KTpPYnNlcnZhYmxlPGFueT4ge1xuXG4gICAgbGV0IHJlcXVlc3RQYXJhbSA9QnVmZmVyLmZyb20oSlNPTi5zdHJpbmdpZnkoZm9ybVBhcmFtcyksICd1dGY4JykudG9TdHJpbmcoJ2Jhc2U2NCcpO1xuICAgIGxldCByZXF1ZXN0VG9rZW4gPSBDcnlwdG9KUy5IbWFjU0hBMjU2KHJlcXVlc3RQYXJhbSwgdGhpcy52YXJsaXN0LmFwaUhhc2hpbmdLZXkpLnRvU3RyaW5nKCk7XG4gICAgbGV0IHJlcURhdGEgPSB7ICdSRVFVRVNUX0RBVEEnOiByZXF1ZXN0UGFyYW0sICdSRVFVRVNUX1RPS0VOJzogcmVxdWVzdFRva2VuIH07XG4gICAgbGV0IHNlcnZpY2VVUkwgPSB0aGlzLnZhcmxpc3Quc2VydmljZVVSTCArICcvZ2V0d2F5VHlwZSc7XG4gICAgbGV0IGRlc25SZXNwb25zZSA9IHRoaXMuaHR0cC5wb3N0KHNlcnZpY2VVUkwsIHJlcURhdGEpO1xuICAgIHJldHVybiBkZXNuUmVzcG9uc2U7XG4gXG4gIH1cblxuXG4gIG5ld0dldHdheUNvbmZpZyhkb2NQYXJhbXM6YW55KTpPYnNlcnZhYmxlPGFueT57XG4gICAgbGV0IHJlcXVlc3RQYXJhbSA9IGJ0b2EoSlNPTi5zdHJpbmdpZnkoZG9jUGFyYW1zKSk7XG4gICAgbGV0IHJlcXVlc3RUb2tlbiA9IENyeXB0b0pTLkhtYWNTSEEyNTYocmVxdWVzdFBhcmFtLCB0aGlzLnZhcmxpc3QuYXBpSGFzaGluZ0tleSkudG9TdHJpbmcoKTtcbiAgICBsZXQgcmVxRGF0YSA9IHsgJ1JFUVVFU1RfREFUQSc6IHJlcXVlc3RQYXJhbSwgJ1JFUVVFU1RfVE9LRU4nOiByZXF1ZXN0VG9rZW4gfTtcbiAgICBsZXQgc2VydmljZVVybCA9IHRoaXMudmFybGlzdC5zZXJ2aWNlVVJMKycvaW5zZXJ0R2F0ZXdheUNvbmZpZ3VyYXRpb24nO1xuICAgIGxldCBzZXJ2aWNlUmVzID0gdGhpcy5odHRwLnBvc3Qoc2VydmljZVVybCxyZXFEYXRhKTtcbiAgICByZXR1cm4gc2VydmljZVJlcztcbiAgfVxuXG5cbiAgIHZpZXdHZXR3YXlDb25maWcoZG9jUGFyYW1zOmFueSk6T2JzZXJ2YWJsZTxhbnk+e1xuICAgIGxldCByZXF1ZXN0UGFyYW0gPSBidG9hKEpTT04uc3RyaW5naWZ5KGRvY1BhcmFtcykpO1xuICAgIGxldCByZXF1ZXN0VG9rZW4gPSBDcnlwdG9KUy5IbWFjU0hBMjU2KHJlcXVlc3RQYXJhbSwgdGhpcy52YXJsaXN0LmFwaUhhc2hpbmdLZXkpLnRvU3RyaW5nKCk7XG4gICAgbGV0IHJlcURhdGEgPSB7ICdSRVFVRVNUX0RBVEEnOiByZXF1ZXN0UGFyYW0sICdSRVFVRVNUX1RPS0VOJzogcmVxdWVzdFRva2VuIH07XG4gICAgbGV0IHNlcnZpY2VVcmwgPSB0aGlzLnZhcmxpc3Quc2VydmljZVVSTCsnL3ZpZXdDb25maWd1cmF0aW9uJztcbiAgICBsZXQgc2VydmljZVJlcyA9IHRoaXMuaHR0cC5wb3N0KHNlcnZpY2VVcmwscmVxRGF0YSk7XG4gICAgcmV0dXJuIHNlcnZpY2VSZXM7XG4gIH1cbiAgZ2V0UHJldkRldGFpbHMoZG9jUGFyYW1zOmFueSk6T2JzZXJ2YWJsZTxhbnk+e1xuICAgIGxldCByZXF1ZXN0UGFyYW0gPSBidG9hKEpTT04uc3RyaW5naWZ5KGRvY1BhcmFtcykpO1xuICAgIGxldCByZXF1ZXN0VG9rZW4gPSBDcnlwdG9KUy5IbWFjU0hBMjU2KHJlcXVlc3RQYXJhbSwgdGhpcy52YXJsaXN0LmFwaUhhc2hpbmdLZXkpLnRvU3RyaW5nKCk7XG4gICAgbGV0IHJlcURhdGEgPSB7ICdSRVFVRVNUX0RBVEEnOiByZXF1ZXN0UGFyYW0sICdSRVFVRVNUX1RPS0VOJzogcmVxdWVzdFRva2VuIH07XG4gICAgbGV0IHNlcnZpY2VVcmwgPSB0aGlzLnZhcmxpc3Quc2VydmljZVVSTCsnL2ZpbGxBbGwnO1xuICAgIGxldCBzZXJ2aWNlUmVzID0gdGhpcy5odHRwLnBvc3Qoc2VydmljZVVybCxyZXFEYXRhKTtcbiAgICByZXR1cm4gc2VydmljZVJlcztcblxuICB9XG5cbiAgZGVsZXRlR2V0d2F5Q29uZmlnKGRvY1BhcmFtczphbnkpOk9ic2VydmFibGU8YW55PntcbiAgICBsZXQgcmVxdWVzdFBhcmFtID0gYnRvYShKU09OLnN0cmluZ2lmeShkb2NQYXJhbXMpKTtcbiAgICBsZXQgcmVxdWVzdFRva2VuID0gQ3J5cHRvSlMuSG1hY1NIQTI1NihyZXF1ZXN0UGFyYW0sIHRoaXMudmFybGlzdC5hcGlIYXNoaW5nS2V5KS50b1N0cmluZygpO1xuICAgIGxldCByZXFEYXRhID0geyAnUkVRVUVTVF9EQVRBJzogcmVxdWVzdFBhcmFtLCAnUkVRVUVTVF9UT0tFTic6IHJlcXVlc3RUb2tlbiB9O1xuICAgIGxldCBzZXJ2aWNlVXJsID0gdGhpcy52YXJsaXN0LnNlcnZpY2VVUkwrJy9kZWxldGVnZXR3YXlEb2N1bWVudCc7XG4gICAgbGV0IHNlcnZpY2VSZXMgPSB0aGlzLmh0dHAucG9zdChzZXJ2aWNlVXJsLHJlcURhdGEpO1xuICAgIHJldHVybiBzZXJ2aWNlUmVzO1xuICB9XG5cbiAgZGVsZXRlQWxsKGZvcm1QYXJhbXMgOiBhbnksIGZuYW1lIDogYW55KTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICBsZXQgcmVxdWVzdFBhcmFtID0gYnRvYShKU09OLnN0cmluZ2lmeShmb3JtUGFyYW1zKSk7XG4gICAgbGV0IHJlcXVlc3RUb2tlbiA9IENyeXB0b0pTLkhtYWNTSEEyNTYocmVxdWVzdFBhcmFtLCB0aGlzLnZhcmxpc3QuYXBpSGFzaGluZ0tleSkudG9TdHJpbmcoKTtcbiAgICBsZXQgcmVxRGF0YSA9IHtcbiAgICAgIFJFUVVFU1RfREFUQTogcmVxdWVzdFBhcmFtLFxuICAgICAgUkVRVUVTVF9UT0tFTjogcmVxdWVzdFRva2VuXG4gICAgfTtcbiAgICBsZXQgc2VydmljZVVybCA9IHRoaXMudmFybGlzdC5zZXJ2aWNlVVJMICsgZm5hbWU7XG4gICAgbGV0IHNlcnZpY2VSZXMgPSB0aGlzLmh0dHAucG9zdChzZXJ2aWNlVXJsLCByZXFEYXRhKTtcbiAgICByZXR1cm4gc2VydmljZVJlcztcbiAgfVxuICBwdWJsaXNoQWxsKGZvcm1QYXJhbXMgOiBhbnksIGZuYW1lIDogYW55KTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICBsZXQgcmVxdWVzdFBhcmFtID0gYnRvYShKU09OLnN0cmluZ2lmeShmb3JtUGFyYW1zKSk7XG4gICAgbGV0IHJlcXVlc3RUb2tlbiA9IENyeXB0b0pTLkhtYWNTSEEyNTYocmVxdWVzdFBhcmFtLCB0aGlzLnZhcmxpc3QuYXBpSGFzaGluZ0tleSkudG9TdHJpbmcoKTtcbiAgICBsZXQgcmVxRGF0YSA9IHtcbiAgICAgIFJFUVVFU1RfREFUQTogcmVxdWVzdFBhcmFtLFxuICAgICAgUkVRVUVTVF9UT0tFTjogcmVxdWVzdFRva2VuXG4gICAgfTtcbiAgICBsZXQgc2VydmljZVVybCA9IHRoaXMudmFybGlzdC5zZXJ2aWNlVVJMICsgZm5hbWU7XG4gICAgbGV0IHNlcnZpY2VSZXMgPSB0aGlzLmh0dHAucG9zdChzZXJ2aWNlVXJsLCByZXFEYXRhKTtcbiAgICByZXR1cm4gc2VydmljZVJlcztcbiAgfVxuICB1bnB1Ymxpc2hBbGwoZm9ybVBhcmFtcyA6IGFueSwgZm5hbWUgOiBhbnkpOiBPYnNlcnZhYmxlPGFueT4ge1xuICAgIGxldCByZXF1ZXN0UGFyYW0gPSBidG9hKEpTT04uc3RyaW5naWZ5KGZvcm1QYXJhbXMpKTtcbiAgICBsZXQgcmVxdWVzdFRva2VuID0gQ3J5cHRvSlMuSG1hY1NIQTI1NihyZXF1ZXN0UGFyYW0sIHRoaXMudmFybGlzdC5hcGlIYXNoaW5nS2V5KS50b1N0cmluZygpO1xuICAgIGxldCByZXFEYXRhID0ge1xuICAgICAgUkVRVUVTVF9EQVRBOiByZXF1ZXN0UGFyYW0sXG4gICAgICBSRVFVRVNUX1RPS0VOOiByZXF1ZXN0VG9rZW5cbiAgICB9O1xuICAgIGxldCBzZXJ2aWNlVXJsID0gdGhpcy52YXJsaXN0LnNlcnZpY2VVUkwgKyBmbmFtZTtcbiAgICBsZXQgc2VydmljZVJlcyA9IHRoaXMuaHR0cC5wb3N0KHNlcnZpY2VVcmwsIHJlcURhdGEpO1xuICAgIHJldHVybiBzZXJ2aWNlUmVzO1xuICB9XG5cbiAgIG5ld01lc3NhZ2UobWVzc2FnZVBhcmFtczphbnkpOk9ic2VydmFibGU8YW55PntcbiAgICAgIGxldCByZXF1ZXN0UGFyYW0gPSBidG9hKEpTT04uc3RyaW5naWZ5KG1lc3NhZ2VQYXJhbXMpKTtcbiAgICAgIGxldCByZXF1ZXN0VG9rZW4gPSBDcnlwdG9KUy5IbWFjU0hBMjU2KHJlcXVlc3RQYXJhbSwgdGhpcy52YXJsaXN0LmFwaUhhc2hpbmdLZXkpLnRvU3RyaW5nKCk7XG4gICAgICBsZXQgcmVxRGF0YSA9IHsgJ1JFUVVFU1RfREFUQSc6IHJlcXVlc3RQYXJhbSwgJ1JFUVVFU1RfVE9LRU4nOiByZXF1ZXN0VG9rZW4gfTtcbiAgICAgIGxldCBzZXJ2aWNlVXJsID0gdGhpcy52YXJsaXN0LnNlcnZpY2VVUkwrJy9hZGRNZXNzYWdlQ29uZmlnJztcbiAgICAgIGxldCBzZXJ2aWNlUmVzID0gdGhpcy5odHRwLnBvc3Qoc2VydmljZVVybCxyZXFEYXRhKTtcbiAgICAgIHJldHVybiBzZXJ2aWNlUmVzO1xuICAgIH1cbiAgLy8gbmV3TWVzc2FnZShtZXNzYWdlUGFyYW1zOiBhbnkpOiBPYnNlcnZhYmxlPGFueT4ge1xuICAvLyAgIGxldCBzZXJ2aWNlVXJsID0gdGhpcy52YXJsaXN0LnNlcnZpY2VVUkwgKyAnYWRkTWVzc2FnZUNvbmZpZyc7XG4gIC8vICAgbGV0IHNlcnZpY2VSZXMgPSB0aGlzLmh0dHAucG9zdChzZXJ2aWNlVXJsLCBtZXNzYWdlUGFyYW1zKTtcbiAgLy8gICByZXR1cm4gc2VydmljZVJlcztcbiAgLy8gfVxuXG4gIHZpZXdNZXNzYWdlKG1lc3NhZ2VQYXJhbXM6IGFueSk6IE9ic2VydmFibGU8YW55PiB7XG4gICAgbGV0IHJlcXVlc3RQYXJhbSA9IGJ0b2EoSlNPTi5zdHJpbmdpZnkobWVzc2FnZVBhcmFtcykpO1xuICAgIGxldCByZXF1ZXN0VG9rZW4gPSBDcnlwdG9KUy5IbWFjU0hBMjU2KHJlcXVlc3RQYXJhbSwgdGhpcy52YXJsaXN0LmFwaUhhc2hpbmdLZXkpLnRvU3RyaW5nKCk7XG4gICAgbWVzc2FnZVBhcmFtcyA9IHsgJ1JFUVVFU1RfREFUQSc6IHJlcXVlc3RQYXJhbSwgJ1JFUVVFU1RfVE9LRU4nOiByZXF1ZXN0VG9rZW4gfVxuICAgIGxldCBzZXJ2aWNlVXJsID0gdGhpcy52YXJsaXN0LnNlcnZpY2VVUkwgKyAnL3ZpZXdNZXNzYWdlQ29uZmlnJztcbiAgICBsZXQgc2VydmljZVJlcyA9IHRoaXMuaHR0cC5wb3N0KHNlcnZpY2VVcmwsIG1lc3NhZ2VQYXJhbXMpO1xuICAgIHJldHVybiBzZXJ2aWNlUmVzO1xuICB9XG4gIHJlbWluZGVyU2NoZWR1bGFyKG1lc3NhZ2VQYXJhbXM6IGFueSk6IE9ic2VydmFibGU8YW55PiB7XG4gICAgbGV0IHJlcXVlc3RQYXJhbSA9IGJ0b2EoSlNPTi5zdHJpbmdpZnkobWVzc2FnZVBhcmFtcykpO1xuICAgIGxldCByZXF1ZXN0VG9rZW4gPSBDcnlwdG9KUy5IbWFjU0hBMjU2KHJlcXVlc3RQYXJhbSwgdGhpcy52YXJsaXN0LmFwaUhhc2hpbmdLZXkpLnRvU3RyaW5nKCk7XG4gICAgbWVzc2FnZVBhcmFtcyA9IHsgJ1JFUVVFU1RfREFUQSc6IHJlcXVlc3RQYXJhbSwgJ1JFUVVFU1RfVE9LRU4nOiByZXF1ZXN0VG9rZW4gfVxuICAgIGxldCBzZXJ2aWNlVXJsID0gdGhpcy52YXJsaXN0LnNlcnZpY2VVUkwgKyAnL2dldFJlbWluZGVyY3Jvbic7XG4gICAgbGV0IHNlcnZpY2VSZXMgPSB0aGlzLmh0dHAucG9zdChzZXJ2aWNlVXJsLCBtZXNzYWdlUGFyYW1zKTtcbiAgICByZXR1cm4gc2VydmljZVJlcztcbiAgfVxuICBtc2dleGVjdXRlU2NoZWR1bGFyKG1lc3NhZ2VQYXJhbXM6IGFueSk6IE9ic2VydmFibGU8YW55PiB7XG4gICAgbGV0IHJlcXVlc3RQYXJhbSA9IGJ0b2EoSlNPTi5zdHJpbmdpZnkobWVzc2FnZVBhcmFtcykpO1xuICAgIGxldCByZXF1ZXN0VG9rZW4gPSBDcnlwdG9KUy5IbWFjU0hBMjU2KHJlcXVlc3RQYXJhbSwgdGhpcy52YXJsaXN0LmFwaUhhc2hpbmdLZXkpLnRvU3RyaW5nKCk7XG4gICAgbWVzc2FnZVBhcmFtcyA9IHsgJ1JFUVVFU1RfREFUQSc6IHJlcXVlc3RQYXJhbSwgJ1JFUVVFU1RfVE9LRU4nOiByZXF1ZXN0VG9rZW4gfVxuICAgIGxldCBzZXJ2aWNlVXJsID0gdGhpcy52YXJsaXN0LnNlcnZpY2VVUkwgKyAnL3N0YXJ0RXhlY3V0aW9uJztcbiAgICBsZXQgc2VydmljZVJlcyA9IHRoaXMuaHR0cC5wb3N0KHNlcnZpY2VVcmwsIG1lc3NhZ2VQYXJhbXMpO1xuICAgIHJldHVybiBzZXJ2aWNlUmVzO1xuICB9XG4gIG1zZ3N0b3BTY2hlZHVsYXIobWVzc2FnZVBhcmFtczogYW55KTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICBsZXQgcmVxdWVzdFBhcmFtID0gYnRvYShKU09OLnN0cmluZ2lmeShtZXNzYWdlUGFyYW1zKSk7XG4gICAgbGV0IHJlcXVlc3RUb2tlbiA9IENyeXB0b0pTLkhtYWNTSEEyNTYocmVxdWVzdFBhcmFtLCB0aGlzLnZhcmxpc3QuYXBpSGFzaGluZ0tleSkudG9TdHJpbmcoKTtcbiAgICBtZXNzYWdlUGFyYW1zID0geyAnUkVRVUVTVF9EQVRBJzogcmVxdWVzdFBhcmFtLCAnUkVRVUVTVF9UT0tFTic6IHJlcXVlc3RUb2tlbiB9XG4gICAgbGV0IHNlcnZpY2VVcmwgPSB0aGlzLnZhcmxpc3Quc2VydmljZVVSTCArICcvc3RvcEV4ZWN1dGlvbic7XG4gICAgbGV0IHNlcnZpY2VSZXMgPSB0aGlzLmh0dHAucG9zdChzZXJ2aWNlVXJsLCBtZXNzYWdlUGFyYW1zKTtcbiAgICByZXR1cm4gc2VydmljZVJlcztcbiAgfVxuXG4gIGdldFN0YXRpY0NvbmZpZ3VyYXRpb25LZXlzKG1lc3NhZ2VQYXJhbXM6IGFueSk6IE9ic2VydmFibGU8YW55PiB7XG4gICAgbGV0IHJlcXVlc3RQYXJhbSA9IGJ0b2EoSlNPTi5zdHJpbmdpZnkobWVzc2FnZVBhcmFtcykpO1xuICAgIGxldCByZXF1ZXN0VG9rZW4gPSBDcnlwdG9KUy5IbWFjU0hBMjU2KHJlcXVlc3RQYXJhbSwgdGhpcy52YXJsaXN0LmFwaUhhc2hpbmdLZXkpLnRvU3RyaW5nKCk7XG4gICAgbWVzc2FnZVBhcmFtcyA9IHsgJ1JFUVVFU1RfREFUQSc6IHJlcXVlc3RQYXJhbSwgJ1JFUVVFU1RfVE9LRU4nOiByZXF1ZXN0VG9rZW4gfVxuICAgIGxldCBzZXJ2aWNlVXJsID0gdGhpcy52YXJsaXN0LnNlcnZpY2VVUkwgKyAnL0dldFN0YXRpY0tleXMnO1xuICAgIGxldCBzZXJ2aWNlUmVzID0gdGhpcy5odHRwLnBvc3Qoc2VydmljZVVybCwgbWVzc2FnZVBhcmFtcyk7XG4gICAgcmV0dXJuIHNlcnZpY2VSZXM7XG4gIH1cbiAgXG5cbiAgZ2V0RmV0Y2hQdWJsaXNoUmVjb3JkKG1lc3NhZ2VQYXJhbXM6IGFueSk6IE9ic2VydmFibGU8YW55PiB7XG4gICAgbGV0IHJlcXVlc3RQYXJhbSA9IGJ0b2EoSlNPTi5zdHJpbmdpZnkobWVzc2FnZVBhcmFtcykpO1xuICAgIGxldCByZXF1ZXN0VG9rZW4gPSBDcnlwdG9KUy5IbWFjU0hBMjU2KHJlcXVlc3RQYXJhbSwgdGhpcy52YXJsaXN0LmFwaUhhc2hpbmdLZXkpLnRvU3RyaW5nKCk7XG4gICAgbWVzc2FnZVBhcmFtcyA9IHsgJ1JFUVVFU1RfREFUQSc6IHJlcXVlc3RQYXJhbSwgJ1JFUVVFU1RfVE9LRU4nOiByZXF1ZXN0VG9rZW4gfVxuICAgIGxldCBzZXJ2aWNlVXJsID0gdGhpcy52YXJsaXN0LnNlcnZpY2VVUkwgKyAnL0ZldGNoUHVibGlzaFJlY29yZCc7XG4gICAgbGV0IHNlcnZpY2VSZXMgPSB0aGlzLmh0dHAucG9zdChzZXJ2aWNlVXJsLCBtZXNzYWdlUGFyYW1zKTtcbiAgICByZXR1cm4gc2VydmljZVJlcztcbiAgfVxuXG5cbiAgZ2V0TGFuZ3VhZ2UobWVzc2FnZVBhcmFtczogYW55KTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICBsZXQgcmVxdWVzdFBhcmFtID0gYnRvYShKU09OLnN0cmluZ2lmeShtZXNzYWdlUGFyYW1zKSk7XG4gICAgbGV0IHJlcXVlc3RUb2tlbiA9IENyeXB0b0pTLkhtYWNTSEEyNTYocmVxdWVzdFBhcmFtLCB0aGlzLnZhcmxpc3QuYXBpSGFzaGluZ0tleSkudG9TdHJpbmcoKTtcbiAgICBtZXNzYWdlUGFyYW1zID0geyAnUkVRVUVTVF9EQVRBJzogcmVxdWVzdFBhcmFtLCAnUkVRVUVTVF9UT0tFTic6IHJlcXVlc3RUb2tlbiB9XG4gICAgbGV0IHNlcnZpY2VVcmwgPSB0aGlzLnZhcmxpc3Quc2VydmljZVVSTCArICcvdmlld0xhbmd1YWdlJztcbiAgICBsZXQgc2VydmljZVJlcyA9IHRoaXMuaHR0cC5wb3N0KHNlcnZpY2VVcmwsIG1lc3NhZ2VQYXJhbXMpO1xuICAgIHJldHVybiBzZXJ2aWNlUmVzO1xuICB9XG5cbiAgZ2V0Rm9ybXMobWVzc2FnZVBhcmFtczogYW55KTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICBsZXQgcmVxdWVzdFBhcmFtID0gYnRvYShKU09OLnN0cmluZ2lmeShtZXNzYWdlUGFyYW1zKSk7XG4gICAgbGV0IHJlcXVlc3RUb2tlbiA9IENyeXB0b0pTLkhtYWNTSEEyNTYocmVxdWVzdFBhcmFtLCB0aGlzLnZhcmxpc3QuYXBpSGFzaGluZ0tleSkudG9TdHJpbmcoKTtcbiAgICBtZXNzYWdlUGFyYW1zID0geyAnUkVRVUVTVF9EQVRBJzogcmVxdWVzdFBhcmFtLCAnUkVRVUVTVF9UT0tFTic6IHJlcXVlc3RUb2tlbiB9XG4gICAgbGV0IHNlcnZpY2VVcmwgPSB0aGlzLnZhcmxpc3Quc2VydmljZVVSTCArICcvZ2V0Rm9ybU5hbWUnO1xuICAgIGxldCBzZXJ2aWNlUmVzID0gdGhpcy5odHRwLnBvc3Qoc2VydmljZVVybCwgbWVzc2FnZVBhcmFtcyk7XG4gICAgcmV0dXJuIHNlcnZpY2VSZXM7XG4gIH1cblxuICBnZXRDb25maWd1cmF0aW9uS2V5cyhtZXNzYWdlUGFyYW1zOiBhbnkpOiBPYnNlcnZhYmxlPGFueT4ge1xuICAgIGxldCByZXF1ZXN0UGFyYW0gPSBidG9hKEpTT04uc3RyaW5naWZ5KG1lc3NhZ2VQYXJhbXMpKTtcbiAgICBsZXQgcmVxdWVzdFRva2VuID0gQ3J5cHRvSlMuSG1hY1NIQTI1NihyZXF1ZXN0UGFyYW0sIHRoaXMudmFybGlzdC5hcGlIYXNoaW5nS2V5KS50b1N0cmluZygpO1xuICAgIG1lc3NhZ2VQYXJhbXMgPSB7ICdSRVFVRVNUX0RBVEEnOiByZXF1ZXN0UGFyYW0sICdSRVFVRVNUX1RPS0VOJzogcmVxdWVzdFRva2VuIH1cbiAgICBsZXQgc2VydmljZVVybCA9IHRoaXMudmFybGlzdC5zZXJ2aWNlVVJMICsgJy9nZXRDb25maWdLZXlzJztcbiAgICBsZXQgc2VydmljZVJlcyA9IHRoaXMuaHR0cC5wb3N0KHNlcnZpY2VVcmwsIG1lc3NhZ2VQYXJhbXMpO1xuICAgIHJldHVybiBzZXJ2aWNlUmVzO1xuICB9XG5cblxuXG4gIHB1YmxpYyBtc2d1cGxvYWRGaWxlKGZvcm1QYXJhbXM6YW55KTpPYnNlcnZhYmxlPGFueT4ge1xuICAgIGxldCBzZXJ2aWNlVVJMID0gdGhpcy52YXJsaXN0LnNlcnZpY2VVUkwgKyAnL2ZpbGVVcGxvYWQnO1xuICAgIGxldCBtb2R1bGVSZXNwb25zZSA9IHRoaXMuaHR0cC5wb3N0KHNlcnZpY2VVUkwsIGZvcm1QYXJhbXMpO1xuICAgIHJldHVybiBtb2R1bGVSZXNwb25zZTtcbiAgfVxuXG5cblxuICBsYW5nUmVwbGFjZShsYW5ndWFnZVRleHQgOiBhbnksIGxhbmd1YWdlTmFtZSA6IGFueSA9IFwiXCIpIHtcbiAgICBpZiAobGFuZ3VhZ2VUZXh0ICE9IFwiXCIgJiYgbGFuZ3VhZ2VUZXh0ICE9dW5kZWZpbmVkKSB7XG4gICAgICBsZXQgbG5nVG9Mb3dlcjogYW55ID0gbGFuZ3VhZ2VUZXh0LnRvTG93ZXJDYXNlKCk7XG5cbiAgICAgbGV0IGFsbExhbmdMaXN0UmVzdWx0OiBhbnkgPSBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKFwiQUxMX0xBTkdfTElTVFwiKTtcblxuICAgIGxldCBTZWV0aW9uUGFyc2VkTGFuZ1JlcyA9IEpTT04ucGFyc2UoQ3J5cHRvSlMuQUVTLmRlY3J5cHQoYWxsTGFuZ0xpc3RSZXN1bHQsIHRoaXMudmFybGlzdC5hcGlIYXNoaW5nS2V5KS50b1N0cmluZyhDcnlwdG9KUy5lbmMuVXRmOCkpO1xuXG4gICAgIGxldCBzZXNzaW9uVXNlckxhbmd0b2tlbjogYW55ID0gc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbShcIlVTRVJfTEFOR1BSRUZcIik7XG5cbiAgICAgbGV0IHNlc3Npb25Vc2VyTGFuZyA9IEpTT04ucGFyc2UoQ3J5cHRvSlMuQUVTLmRlY3J5cHQoc2Vzc2lvblVzZXJMYW5ndG9rZW4sIHRoaXMudmFybGlzdC5hcGlIYXNoaW5nS2V5KS50b1N0cmluZyhDcnlwdG9KUy5lbmMuVXRmOCkpO1xuXG4gICAgICBpZiAoU2VldGlvblBhcnNlZExhbmdSZXNbbG5nVG9Mb3dlcl0gIT0gdW5kZWZpbmVkKSB7XG4gICAgICAgbGV0IGFsbFBhcnNlZExhbmcgPSBKU09OLnBhcnNlKFNlZXRpb25QYXJzZWRMYW5nUmVzW2xuZ1RvTG93ZXJdKTtcbiAgICAgICByZXR1cm4gYWxsUGFyc2VkTGFuZ1tzZXNzaW9uVXNlckxhbmddICE9IFwiXCIgJiYgYWxsUGFyc2VkTGFuZ1tzZXNzaW9uVXNlckxhbmddICE9IHVuZGVmaW5lZFxuICAgICAgICAgPyBhbGxQYXJzZWRMYW5nW3Nlc3Npb25Vc2VyTGFuZ11cbiAgICAgICAgIDogbGFuZ3VhZ2VUZXh0O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGxhbmd1YWdlVGV4dDtcbiAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gbGFuZ3VhZ2VUZXh0O1xuICAgIH1cbiB9XG5cblxuIHN3YWxmaXJlKHR5cGU6IGFueSwgbWVzc2FnZTogYW55KSB7XG4gIHJldHVybiAgU3dhbC5maXJlKHtcbiAgICAgICAgICAgaWNvbjogdHlwZSxcbiAgICAgICAgICAgdGV4dDogbWVzc2FnZVxuICAgICAgICAgICB9KTtcbiBcbiB9XG5cblxufVxuIl19